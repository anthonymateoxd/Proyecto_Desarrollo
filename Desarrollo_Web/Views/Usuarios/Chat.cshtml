@model IEnumerable<DemonSlayer.Models.Mensaje>

@{
    var destinatario = ViewBag.Destinatario as DemonSlayer.Models.Usuario;
    ViewData["Title"] = $"Chat con {destinatario?.NombreCompleto}";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>💬 Chat con @destinatario?.NombreCompleto</h1>
        <a asp-action="Conversaciones" class="btn btn-secondary">← Conversaciones</a>
    </div>

    <!-- Área de Chat -->
    <div class="chat-container border rounded p-3 bg-light" style="max-height: 500px; overflow-y: auto;">
        @if (Model.Any())
        {
            foreach (var mensaje in Model)
            {
                var esMio = mensaje.RemitenteId == ViewBag.UserId;

                <div class="message @(esMio ? "message-sent" : "message-received") mb-3">
                    <div class="@(esMio ? "ms-auto" : "")" style="max-width: 70%;">
                        <div class="message-text @(esMio ? "bg-primary text-white" : "bg-white") p-2 rounded border">
                            @mensaje.Texto
                        </div>
                        <small class="text-muted">@mensaje.Fecha.ToString("HH:mm")</small>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="text-center text-muted py-4">
                <p>💬 No hay mensajes todavía.</p>
                <p>¡Inicia la conversación!</p>
            </div>
        }
    </div>

    <!-- Formulario para enviar mensaje -->
    <div class="mt-3">
        <form asp-action="EnviarMensaje" method="post">
            <input type="hidden" name="destinatarioId" value="@ViewBag.DestinatarioId" />
            <div class="input-group">
                <textarea name="texto" class="form-control" placeholder="Escribe tu mensaje..." rows="2" required></textarea>
                <button type="submit" class="btn btn-success">Enviar</button>
            </div>
        </form>
    </div>
</div>